{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import API from\"../services/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function VerifyCode(){const navigate=useNavigate();const[code,setCode]=useState(\"\");const[message,setMessage]=useState(\"\");const[email,setEmail]=useState(\"\");useEffect(()=>{const pendingEmail=localStorage.getItem(\"pendingEmail\");if(!pendingEmail){setMessage(\"Session expirée, veuillez vous reconnecter.\");setTimeout(()=>navigate(\"/login\"),1500);}else{setEmail(pendingEmail);setMessage(\"2FA code sent to your email\");}},[navigate]);const handleSubmit=async e=>{e.preventDefault();setMessage(\"\");if(!email)return;try{const response=await API.post(\"/auth/verify-2fa\",{email,code});if(response.data.access_token){localStorage.setItem(\"token\",response.data.access_token);localStorage.removeItem(\"pendingEmail\");setMessage(\"Connexion réussie !\");setTimeout(()=>navigate(\"/\"),1500);}else{setMessage(response.data.message||\"Code invalide.\");}}catch(error){var _error$response;console.error(\"Erreur :\",((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);setMessage(\"Impossible de contacter le serveur.\");}};if(!email)return/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-red-500\",children:message});return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md mx-auto mt-10 p-6 shadow-md rounded-xl bg-white\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4 text-center\",children:\"V\\xE9rification du code\"}),message&&/*#__PURE__*/_jsx(\"p\",{className:\"mb-4 text-center text-blue-500\",children:message}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Entrez le code re\\xE7u par email\",value:code,onChange:e=>setCode(e.target.value),required:true,className:\"w-full p-2 border rounded\",autoComplete:\"one-time-code\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition\",children:\"V\\xE9rifier\"})]})]});}export default VerifyCode;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","API","jsx","_jsx","jsxs","_jsxs","VerifyCode","navigate","code","setCode","message","setMessage","email","setEmail","pendingEmail","localStorage","getItem","setTimeout","handleSubmit","e","preventDefault","response","post","data","access_token","setItem","removeItem","error","_error$response","console","className","children","onSubmit","type","placeholder","value","onChange","target","required","autoComplete"],"sources":["/home/kanga_prog_unix/hbnb_v2_frontend/src/pages/VerifyCode.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport API from \"../services/api\";\n\nfunction VerifyCode() {\n  const navigate = useNavigate();\n  const [code, setCode] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n\n  useEffect(() => {\n    const pendingEmail = localStorage.getItem(\"pendingEmail\");\n    if (!pendingEmail) {\n      setMessage(\"Session expirée, veuillez vous reconnecter.\");\n      setTimeout(() => navigate(\"/login\"), 1500);\n    } else {\n      setEmail(pendingEmail);\n      setMessage(\"2FA code sent to your email\");\n    }\n  }, [navigate]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setMessage(\"\");\n\n    if (!email) return;\n\n    try {\n      const response = await API.post(\"/auth/verify-2fa\", { email, code });\n\n      if (response.data.access_token) {\n        localStorage.setItem(\"token\", response.data.access_token);\n        localStorage.removeItem(\"pendingEmail\");\n        setMessage(\"Connexion réussie !\");\n        setTimeout(() => navigate(\"/\"), 1500);\n      } else {\n        setMessage(response.data.message || \"Code invalide.\");\n      }\n    } catch (error) {\n      console.error(\"Erreur :\", error.response?.data || error.message);\n      setMessage(\"Impossible de contacter le serveur.\");\n    }\n  };\n\n  if (!email) return <p className=\"text-center text-red-500\">{message}</p>;\n\n  return (\n    <div className=\"max-w-md mx-auto mt-10 p-6 shadow-md rounded-xl bg-white\">\n      <h2 className=\"text-2xl font-bold mb-4 text-center\">Vérification du code</h2>\n      {message && <p className=\"mb-4 text-center text-blue-500\">{message}</p>}\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\n        <input\n          type=\"text\"\n          placeholder=\"Entrez le code reçu par email\"\n          value={code}\n          onChange={(e) => setCode(e.target.value)}\n          required\n          className=\"w-full p-2 border rounded\"\n          autoComplete=\"one-time-code\"\n        />\n        <button\n          type=\"submit\"\n          className=\"w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition\"\n        >\n          Vérifier\n        </button>\n      </form>\n    </div>\n  );\n}\n\nexport default VerifyCode;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
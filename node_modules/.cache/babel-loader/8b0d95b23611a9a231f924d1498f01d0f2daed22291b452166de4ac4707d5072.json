{"ast":null,"code":"import React from\"react\";import{useNavigate}from\"react-router-dom\";import PlaceForm from\"../components/place/PlaceForm\";import API,{createPlace}from\"../services/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CreatePlace=()=>{const navigate=useNavigate();const handleCreate=async data=>{try{// 1️⃣ Construire un payload propre pour le backend\nconst payload={name:data.name,price_by_night:parseInt(data.price_by_night,10)};// Champs optionnels : on n'envoie que ceux qui existent\nif(data.description!==undefined)payload.description=data.description;if(data.location!==undefined)payload.location=data.location;if(data.country!==undefined)payload.country=data.country;if(data.town!==undefined)payload.town=data.town;if(data.latitude!==undefined)payload.latitude=Number(data.latitude);if(data.longitude!==undefined)payload.longitude=Number(data.longitude);if(data.amenities&&data.amenities.length>0){payload.amenity_ids=data.amenities.map(id=>parseInt(id,10));}console.log(\"Payload envoyé au backend :\",payload);// 2️⃣ CRÉATION DU LIEU\nconst response=await createPlace(payload);console.log(\"PLACE CRÉÉE :\",response);const placeId=response.id;// 3️⃣ UPLOAD DES IMAGES SI ELLES EXISTENT\nif(data.images&&data.images.length>0){await Promise.all(data.images.map(img=>{if(img instanceof File){// UPLOAD LOCAL FILE\nconst formData=new FormData();formData.append(\"file\",img);return API.post(\"/places/\".concat(placeId,\"/images\"),formData);}else if(typeof img===\"string\"){// URL EXISTANTE\nreturn API.post(\"/places/\".concat(placeId,\"/images\"),{url:img});}return Promise.resolve(null);// ✅ Éviter warning ESLint\n}));console.log(\"IMAGES CRÉÉES ET LIÉES À LA PLACE !\");}// 4️⃣ REDIRECTION VERS LE DÉTAIL DU LIEU\nnavigate(\"/places/\".concat(placeId));}catch(err){var _err$response,_err$response$data;console.error(\"ERREUR LORS DE LA CRÉATION :\",err);alert(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||\"ERREUR LORS DE LA CRÉATION DU LIEU\");}};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:\"2rem\"},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"CR\\xC9ER UN NOUVEAU LIEU\"}),/*#__PURE__*/_jsx(PlaceForm,{onSubmit:handleCreate})]});};export default CreatePlace;","map":{"version":3,"names":["React","useNavigate","PlaceForm","API","createPlace","jsx","_jsx","jsxs","_jsxs","CreatePlace","navigate","handleCreate","data","payload","name","price_by_night","parseInt","description","undefined","location","country","town","latitude","Number","longitude","amenities","length","amenity_ids","map","id","console","log","response","placeId","images","Promise","all","img","File","formData","FormData","append","post","concat","url","resolve","err","_err$response","_err$response$data","error","alert","message","style","padding","children","onSubmit"],"sources":["/home/kanga_prog_unix/hbnb_v2_frontend/src/pages/CreatePlace.jsx"],"sourcesContent":["import React from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport PlaceForm from \"../components/place/PlaceForm\";\nimport API, { createPlace } from \"../services/api\";\n\nconst CreatePlace = () => {\n  const navigate = useNavigate();\n\n  const handleCreate = async (data) => {\n    try {\n      // 1️⃣ Construire un payload propre pour le backend\n      const payload = {\n        name: data.name,\n        price_by_night: parseInt(data.price_by_night, 10),\n      };\n\n      // Champs optionnels : on n'envoie que ceux qui existent\n      if (data.description !== undefined) payload.description = data.description;\n      if (data.location !== undefined) payload.location = data.location;\n      if (data.country !== undefined) payload.country = data.country;\n      if (data.town !== undefined) payload.town = data.town;\n      if (data.latitude !== undefined) payload.latitude = Number(data.latitude);\n      if (data.longitude !== undefined) payload.longitude = Number(data.longitude);\n      if (data.amenities && data.amenities.length > 0) {\n        payload.amenity_ids = data.amenities.map((id) => parseInt(id, 10));\n      }\n      console.log(\"Payload envoyé au backend :\", payload);\n      \n      // 2️⃣ CRÉATION DU LIEU\n      const response = await createPlace(payload);\n      console.log(\"PLACE CRÉÉE :\", response);\n      const placeId = response.id;\n\n      // 3️⃣ UPLOAD DES IMAGES SI ELLES EXISTENT\n      if (data.images && data.images.length > 0) {\n        await Promise.all(\n          data.images.map((img) => {\n            if (img instanceof File) {\n              // UPLOAD LOCAL FILE\n              const formData = new FormData();\n              formData.append(\"file\", img);\n              return API.post(`/places/${placeId}/images`, formData);\n            } else if (typeof img === \"string\") {\n              // URL EXISTANTE\n              return API.post(`/places/${placeId}/images`, { url: img });\n            }\n            return Promise.resolve(null); // ✅ Éviter warning ESLint\n          })\n        );\n        console.log(\"IMAGES CRÉÉES ET LIÉES À LA PLACE !\");\n      }\n\n      // 4️⃣ REDIRECTION VERS LE DÉTAIL DU LIEU\n      navigate(`/places/${placeId}`);\n    } catch (err) {\n      console.error(\"ERREUR LORS DE LA CRÉATION :\", err);\n      alert(err.response?.data?.message || \"ERREUR LORS DE LA CRÉATION DU LIEU\");\n    }\n  };\n\n  return (\n    <div style={{ padding: \"2rem\" }}>\n      <h1>CRÉER UN NOUVEAU LIEU</h1>\n      <PlaceForm onSubmit={handleCreate} />\n    </div>\n  );\n};\n\nexport default CreatePlace;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
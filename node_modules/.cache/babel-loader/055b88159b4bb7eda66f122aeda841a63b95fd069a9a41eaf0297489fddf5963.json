{"ast":null,"code":"// src/components/place/ReviewList.jsx\nimport{useEffect,useState,forwardRef,useImperativeHandle,useCallback}from\"react\";import API from\"../../services/api\";import ReviewCard from\"./ReviewCard\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ReviewList=/*#__PURE__*/forwardRef((_ref,ref)=>{let{place_Id}=_ref;const[reviews,setReviews]=useState([]);const[error,setError]=useState(\"\");const userId=localStorage.getItem(\"user_id\");// âœ… user connectÃ©\n// ðŸ”¹ fetchReviews mÃ©morisÃ©\nconst fetchReviews=useCallback(async()=>{try{const res=await API.get(\"/places/\".concat(place_Id,\"/reviews\"));// ðŸ”¹ garantir que reviews est toujours un tableau\nsetReviews(Array.isArray(res.data)?res.data:[]);}catch(err){console.error(\"Erreur fetch reviews:\",err);setError(\"Erreur chargement avis.\");setReviews([]);// reset si erreur\n}},[place_Id]);// ðŸ”¹ appel initial\nuseEffect(()=>{fetchReviews();},[fetchReviews]);// ðŸ”¹ expose refreshReviews() au parent\nuseImperativeHandle(ref,()=>({refreshReviews:fetchReviews}));// ðŸ”¹ suppression review\nconst handleDelete=async reviewId=>{if(!window.confirm(\"Supprimer cet avis ?\"))return;try{const token=localStorage.getItem(\"token\");await API.delete(\"/places/\".concat(place_Id,\"/reviews/\").concat(reviewId),{headers:{Authorization:\"Bearer \".concat(token)}});setReviews(prev=>prev.filter(r=>r.id!==reviewId));}catch(err){console.error(\"Erreur suppression review:\",err);setError(\"Impossible de supprimer cet avis.\");}};if(error)return/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500\",children:error});return/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold mb-4\",children:\"Avis des utilisateurs :\"}),reviews.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Aucun avis pour ce lieu.\"}):/*#__PURE__*/_jsx(\"ul\",{className:\"space-y-4\",children:reviews.map(r=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(ReviewCard,{review:r,onDelete:handleDelete,canDelete:userId&&parseInt(userId)===r.user_id})},r.id))})]});});export default ReviewList;","map":{"version":3,"names":["useEffect","useState","forwardRef","useImperativeHandle","useCallback","API","ReviewCard","jsx","_jsx","jsxs","_jsxs","ReviewList","_ref","ref","place_Id","reviews","setReviews","error","setError","userId","localStorage","getItem","fetchReviews","res","get","concat","Array","isArray","data","err","console","refreshReviews","handleDelete","reviewId","window","confirm","token","delete","headers","Authorization","prev","filter","r","id","className","children","length","map","review","onDelete","canDelete","parseInt","user_id"],"sources":["/home/kanga_prog_unix/hbnb_v2_frontend/src/components/place/ReviewList.jsx"],"sourcesContent":["// src/components/place/ReviewList.jsx\nimport {\n  useEffect,\n  useState,\n  forwardRef,\n  useImperativeHandle,\n  useCallback,\n} from \"react\";\nimport API from \"../../services/api\";\nimport ReviewCard from \"./ReviewCard\";\n\nconst ReviewList = forwardRef(({ place_Id }, ref) => {\n  const [reviews, setReviews] = useState([]);\n  const [error, setError] = useState(\"\");\n  const userId = localStorage.getItem(\"user_id\"); // âœ… user connectÃ©\n\n  // ðŸ”¹ fetchReviews mÃ©morisÃ©\n  const fetchReviews = useCallback(async () => {\n    try {\n      const res = await API.get(`/places/${place_Id}/reviews`);\n      // ðŸ”¹ garantir que reviews est toujours un tableau\n      setReviews(Array.isArray(res.data) ? res.data : []);\n    } catch (err) {\n      console.error(\"Erreur fetch reviews:\", err);\n      setError(\"Erreur chargement avis.\");\n      setReviews([]); // reset si erreur\n    }\n  }, [place_Id]);\n\n  // ðŸ”¹ appel initial\n  useEffect(() => {\n    fetchReviews();\n  }, [fetchReviews]);\n\n  // ðŸ”¹ expose refreshReviews() au parent\n  useImperativeHandle(ref, () => ({\n    refreshReviews: fetchReviews,\n  }));\n\n  // ðŸ”¹ suppression review\n  const handleDelete = async (reviewId) => {\n    if (!window.confirm(\"Supprimer cet avis ?\")) return;\n    try {\n      const token = localStorage.getItem(\"token\");\n      await API.delete(`/places/${place_Id}/reviews/${reviewId}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      setReviews((prev) => prev.filter((r) => r.id !== reviewId));\n    } catch (err) {\n      console.error(\"Erreur suppression review:\", err);\n      setError(\"Impossible de supprimer cet avis.\");\n    }\n  };\n\n  if (error) return <p className=\"text-red-500\">{error}</p>;\n\n  return (\n    <div className=\"mt-6\">\n      <h3 className=\"text-lg font-bold mb-4\">Avis des utilisateurs :</h3>\n\n      {reviews.length === 0 ? (\n        <p className=\"text-gray-500\">Aucun avis pour ce lieu.</p>\n      ) : (\n        <ul className=\"space-y-4\">\n          {reviews.map((r) => (\n            <li key={r.id}>\n              <ReviewCard\n                review={r}\n                onDelete={handleDelete}\n                canDelete={userId && parseInt(userId) === r.user_id}\n              />\n            </li>\n          ))}\n        </ul>\n      )}\n    </div>\n  );\n});\n\nexport default ReviewList;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
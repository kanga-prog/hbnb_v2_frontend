{"ast":null,"code":"import{useEffect,useState}from\"react\";import{useParams,useNavigate}from\"react-router-dom\";import API from\"../services/api\";import PlaceForm from\"../components/place/PlaceForm\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function EditPlace(){const{id}=useParams();const navigate=useNavigate();const[place,setPlace]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{API.get(\"/places/\".concat(id,\"/\")).then(res=>setPlace(res.data)).catch(err=>{console.error(err);alert(\"Impossible de charger le lieu.\");}).finally(()=>setLoading(false));},[id]);const handleUpdate=async data=>{try{// Étape 1 : update JSON\nconst payload={name:data.name,description:data.description,price_by_night:Number(data.price_by_night),location:data.location,country:data.country,town:data.town,latitude:data.latitude?Number(data.latitude):null,longitude:data.longitude?Number(data.longitude):null,amenity_ids:data.amenities||[]};await API.put(\"/places/\".concat(id,\"/\"),payload,{headers:{\"Content-Type\":\"application/json\"}});// Étape 2 : upload des nouvelles images\nif(data.images&&data.images.length>0){for(const file of data.images){const formData=new FormData();formData.append(\"file\",file);await API.post(\"/places/\".concat(id,\"/images\"),formData,{headers:{\"Content-Type\":\"multipart/form-data\"}});}}alert(\"Lieu mis à jour !\");navigate(\"/places/\".concat(id));}catch(err){var _err$response,_err$response$data;console.error(\"Erreur mise à jour :\",err);alert(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||\"Erreur lors de la mise à jour\");}};if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Chargement...\"});if(!place)return/*#__PURE__*/_jsx(\"p\",{children:\"Lieu introuvable.\"});return/*#__PURE__*/_jsx(PlaceForm,{onSubmit:handleUpdate,initialData:place});}","map":{"version":3,"names":["useEffect","useState","useParams","useNavigate","API","PlaceForm","jsx","_jsx","EditPlace","id","navigate","place","setPlace","loading","setLoading","get","concat","then","res","data","catch","err","console","error","alert","finally","handleUpdate","payload","name","description","price_by_night","Number","location","country","town","latitude","longitude","amenity_ids","amenities","put","headers","images","length","file","formData","FormData","append","post","_err$response","_err$response$data","response","message","children","onSubmit","initialData"],"sources":["/home/kanga_prog_unix/hbnb_v2_frontend/src/pages/EditPlace.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport API from \"../services/api\";\nimport PlaceForm from \"../components/place/PlaceForm\";\n\nexport default function EditPlace() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const [place, setPlace] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    API.get(`/places/${id}/`)\n      .then((res) => setPlace(res.data))\n      .catch((err) => {\n        console.error(err);\n        alert(\"Impossible de charger le lieu.\");\n      })\n      .finally(() => setLoading(false));\n  }, [id]);\n\n  const handleUpdate = async (data) => {\n    try {\n      // Étape 1 : update JSON\n      const payload = {\n        name: data.name,\n        description: data.description,\n        price_by_night: Number(data.price_by_night),\n        location: data.location,\n        country: data.country,\n        town: data.town,\n        latitude: data.latitude ? Number(data.latitude) : null,\n        longitude: data.longitude ? Number(data.longitude) : null,\n        amenity_ids: data.amenities || [],\n      };\n\n      await API.put(`/places/${id}/`, payload, {\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n\n      // Étape 2 : upload des nouvelles images\n      if (data.images && data.images.length > 0) {\n        for (const file of data.images) {\n          const formData = new FormData();\n          formData.append(\"file\", file);\n          await API.post(`/places/${id}/images`, formData, {\n            headers: { \"Content-Type\": \"multipart/form-data\" },\n          });\n        }\n      }\n\n      alert(\"Lieu mis à jour !\");\n      navigate(`/places/${id}`);\n    } catch (err) {\n      console.error(\"Erreur mise à jour :\", err);\n      alert(err.response?.data?.message || \"Erreur lors de la mise à jour\");\n    }\n  };\n\n  if (loading) return <p>Chargement...</p>;\n  if (!place) return <p>Lieu introuvable.</p>;\n\n  return <PlaceForm onSubmit={handleUpdate} initialData={place} />;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}